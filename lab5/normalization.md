-------------------------------------------------------------------------------

Лабораторна робота 5: Нормалізація бази даних

-------------------------------------------------------------------------------
1. Початковий дизайн таблиць (до нормалізації)
Аналіз проводився на основі наданої ER-діаграми. Проблемні залежності були виявлені у однієї таблиці - User

Таблиця User:
UserID (PK)
FullName
Email
PasswordHash
Position (Порушення: Посада залежить від контексту (команди), а не лише від користувача)
-------------------------------------------------------------------------------
2. Функціональні залежності (ФЗ) початкової схеми
Для проблемної таблиці були визначені наступні функціональні залежності:

Таблиця User:
UserID → FullName, Email, PasswordHash. (Залежність від ПК)
UserID → Position. (Вважається, що це єдиний ФЗ, але ми знаємо, що він помилковий з точки зору бізнес-логіки)Проблема (Порушення 3NF): Роль (Position) є контекстуальною (наприклад, у команді), тому вона не повинна зберігатися в таблиці "User". Вона повинна залежати від складеного ключа в проміжній таблиці, щоб коректно відображати: "Користувач X має Роль Y у Команді Z".
-------------------------------------------------------------------------------
3. Аналіз початкових нормальних форм
Був проведений аналіз всієї схеми на відповідність нормальним формам

1NF (Перша нормальна форма): Схема знаходиться в 1NF. Усі атрибути в усіх таблицях є атомарними (не містять списків чи вкладених значень).

2NF (Друга нормальна форма):** Схема знаходиться в 2NF. Усі первинні ключі в схемі є простими (не складеними). Оскільки 2NF стосується усунення часткових залежностей від складеного ключа, а таких ключів немає, то схема автоматично знаходиться в 2NF.

3NF (Третя нормальна форма):** Схема НЕ знаходиться в 3NF.

Порушення 3NF: Існує неявна транзитивна залежність або невідповідне розташування неключового атрибута.  Атрибут Position повинен відображати роль користувача в конкретній команді або конкретному проєкті (тобто його місце в ієрархії залежить від контексту). Зберігання його в таблиці "User" призводить до надмірності та неузгодженості у випадках, коли користувач має різні ролі в різних командах/проєктах.
-------------------------------------------------------------------------------
4. План нормалізації до 3NF
Мета: Видалити Position з таблиці "User" та коректно розмістити його в проміжній таблиці, де він залежить від складеного ключа (TeamID, UserID).
Проблема: Атрибут Position у таблиці "User" не залежить виключно від первинного ключа (UserID), а залежить від контексту (якої команди стосується). Це створює надмірність та аномалії оновлення.

Наприклад, якщо Анна Коваль є "Team Lead" у Team 1 і "Developer" у Team 2, ми не можемо зберігати одну позицію в її особистому профілі.

Вирішення:

1.Видалити стовпець Position з таблиці "User".
2.Додати стовпець Role (який тепер буде представляти посаду/роль) до проміжної таблиці Team_User. Це дозволяє Role залежати від складеного ключа (TeamID, UserID), що відповідає 3NF.

SQL-команди (ALTER) для Нормалізації:
1.Видалення зовнішнього ключа та стовпця Position з "User":
ALTER TABLE "User" 
DROP COLUMN Position;
2.Додавання стовпця Role до проміжної таблиці Team_User:
ALTER TABLE Team_User
ADD COLUMN Role VARCHAR(50) NOT NULL DEFAULT 'Member';
-------------------------------------------------------------------------------
5. Результат: Схема в 3NF (Фінальний дизайн)

Після виконання кроків нормалізації таблиці виглядають так:
Таблиця "User" (Нормалізована):
UserID (PK)
FullName
Email
PasswordHash
(Position видалено)

Таблиця Team_User (Нормалізована до 3NF):
TeamID (PK, FK)
UserID (PK, FK)
Role (Тепер залежить від усього ключа: (TeamID, UserID) → Role)
Усі транзитивні залежності усунуто. Вся схема тепер відповідає Третій нормальній формі (3NF).
-------------------------------------------------------------------------------
